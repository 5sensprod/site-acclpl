<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Exemple de requÃªte d'autorisation avec navigator.permissions.query()</title>
  </head>
  <body>
    <button id="capture">Prendre une photo</button>
    <video id="camera-stream" autoplay></video>
    <canvas id="photo-canvas"></canvas>
    
    <script>
      const captureButton = document.getElementById('capture');
      const cameraStream = document.getElementById('camera-stream');
      const photoCanvas = document.getElementById('photo-canvas');
      const photoContext = photoCanvas.getContext('2d');
      
      captureButton.addEventListener('click', async () => {
        try {
          const permission = await navigator.permissions.query({name: 'camera'});
          if (permission.state === 'granted') {
            const stream = await navigator.mediaDevices.getUserMedia({video: true});
            cameraStream.srcObject = stream;
            await new Promise(resolve => cameraStream.onloadedmetadata = resolve);
            
            photoCanvas.width = cameraStream.videoWidth;
            photoCanvas.height = cameraStream.videoHeight;
            photoContext.drawImage(cameraStream, 0, 0);
            
            stream.getTracks().forEach(track => track.stop());
            cameraStream.srcObject = null;
            
            const photoData = photoCanvas.toDataURL();
            console.log(photoData);
          } else {
            console.log('Permission denied');
          }
        } catch (error) {
          console.error('Error accessing media devices.', error);
        }
      });
    </script>
  </body>
</html>
